# 任务匹配系统插件 (Task Queue Plugin)

一个智能的任务匹配排队系统，适用于AstrBot框架。自动将待命成员与发布的任务进行匹配，支持多群聊独立管理、超时处理、权限控制等功能。

## 功能特性

- 🎯 **智能匹配** - 自动将最早待命的成员与发布的任务匹配
- 🚀 **多群聊支持** - 每个群聊独立管理自己的待命队列
- 🔔 **自动通知** - 匹配成功后自动@通知待命成员
- ⏰ **超时处理** - 支持匹配超时自动重新分配
- 🔒 **权限控制** - 管理员可清空队列等敏感操作
- 🔄 **重复待命控制** - 可配置是否允许已匹配用户再次待命
- ⏱️ **定时清除** - 支持定时清空所有数据
- 💾 **数据持久化** - 数据自动保存，重启不丢失

## 安装方法

1. 将插件目录放入 AstrBot 的 `data/plugins/` 目录下
2. 重启 AstrBot 或在管理面板中重载插件
3. 在管理面板中配置插件参数（可选）

## 配置说明

| 配置项 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `task_name` | string | "任务" | 任务名称，显示在提示信息中 |
| `max_queue_size` | int | 50 | 待命队列最大人数 |
| `enable_auto_clear` | bool | false | 是否启用定时清空数据 |
| `clear_time` | string | "23:59" | 清空数据时间（格式：HH:MM） |
| `task_notify_message` | string | "有活儿了！直接来⬆️吧⬇️！！" | 通知待命成员的消息模板 |
| `queue_status_title` | string | "待命成员列表" | 显示队列状态时的标题 |
| `waiting_label` | string | "待命中" | 待命成员的标签 |
| `matched_label` | string | "已匹配" | 已匹配任务的成员标签 |
| `allow_rematch` | bool | true | 是否允许已匹配用户再次待命 |
| `admin_users` | list | [] | 管理员用户ID列表 |
| `match_timeout` | int | 300 | 匹配后等待确认的超时时间（秒） |
| `auto_cleanup` | bool | true | 是否自动清理超时未确认的匹配 |

## 使用说明

### 📝 自然语言触发

#### 加入待命队列
发送以下任意关键词即可加入待命队列：
- `有无活`
- `找活干`
- `待命`
- `求组`
- `求带`
- `求任务`

#### 发布任务
发送包含以下任意触发词的消息：
- `=1`、`=2`、`=3`、`=4`、`=5`
- `等1`、`等2`、`等3`、`等4`、`等5`

例如：
- "副本缺人=1"
- "等2个输出"
- "任务=3"

系统会自动匹配最早待命的成员，并@通知。

### 🤖 指令系统

| 指令 | 说明 |
|------|------|
| `task/help` | 显示帮助信息 |
| `task/status` | 查看当前待命状态 |
| `task/leave` | 退出待命队列 |
| `task/clear` | 清空当前群聊数据（管理员） |
| `task/clear_all` | 清空所有群聊数据（高级管理员） |

## 使用流程

1. **待命阶段**：用户发送"有无活"等关键词加入待命队列
2. **任务发布**：有人发送"=1"等触发词发布任务
3. **自动匹配**：系统自动匹配最早待命的成员
4. **通知确认**：被匹配的成员收到@通知，需在规定时间内确认
5. **任务执行**：确认后进入已匹配状态，队列自动前移
6. **超时处理**：超时未确认则自动重新匹配下一位

## 特色功能

### 🎯 智能匹配机制
- 采用先进先出(FIFO)原则匹配最早待命的成员
- 支持匹配超时自动重新分配
- 可配置是否允许已匹配用户再次待命

### ⏰ 超时管理
- 匹配后开始计时，默认5分钟确认时间
- 超时未确认自动放回队列（如配置允许）
- 支持自定义超时时间

### 📊 状态追踪
- 实时查看待命队列状态
- 查看个人待命位置
- 查看当前已匹配任务

### 🔐 权限管理
- 管理员可清空队列
- 支持多级权限控制
- 敏感操作需要验证

## 技术特性

- ✅ **数据持久化**：使用AstrBot键值存储，重启不丢失
- ✅ **异步处理**：全异步实现，不阻塞主线程
- ✅ **超时处理**：完善的超时管理机制
- ✅ **错误处理**：完善的异常捕获和日志记录
- ✅ **消息链支持**：支持@用户等富文本消息

